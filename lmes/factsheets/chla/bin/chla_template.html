<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="Cache-Control" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>
    <title>LMES CHLA</title>
    <!-- ADDED -->
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <!-- END -->
    <script type="text/javascript" src="http://code.highcharts.com/highcharts.js"></script>
    <script type="text/javascript" src="http://code.highcharts.com/modules/exporting.js"></script>
    <script type="text/javascript" src="http://code.highcharts.com/highcharts-more.js"></script>
    <style>
      .ui-autocomplete{max-height:100px, overflow-y:auto;overflow-x:hidden;}
      html .ui-autocomplete{height:100px} /* IE6 does not support max-height */
      .ui-widget{font-size:12px;}
    </style>
    <script type="text/javascript">
      $(document).ready(function() {
      
      var thisLMECode = THISLMECODETOREPLACE;
      var addedLMECode = -1;
      var plotCounter = -1;
      
      function genChart(LMECode) {
      
      var options = {
       credits:{enabled:false},
       chart: {renderTo: 'container', type: 'line', zoomType:'x',
       resetZoomButton:{relativeTo:'chart', position: {align:'right', verticalAlign: 'bottom', x:-10, y:-75},
       theme:{fill: 'white', stroke:'red', r:0, states:{hover:{fill:'#41739D', style:{color:'white'}}}}
       }
      },
      //             legend:{align:'right', verticalAlign:'top', layout:'vertical', y:25},
      legend:{align:'center', layout:'horizontal', itemWidth:120},
      title: { text: 'CHARTTITLETOREPLACE' },
      xAxis: { title:{enabled:true, text:'Years'}, labels:{formatter:function(){return Highcharts.numberFormat(this.value, 0, '','');}}},
      yAxis: { title: { text: 'mg.m<sup>-3</sup>' , useHTML:true} },
      series: [],
      plotOptions:{series:{animation:false}},
      tooltip:{valueDecimals: 2, formatter:function(){
      if (this.series.name =="Min-Max") {
      return this.series.name+'<br/>'+this.x.toFixed(0) + ': '+Highcharts.numberFormat(this.point.low,2)+' - '+Highcharts.numberFormat(this.point.high,2);
      } else {
      return this.series.name+'<br/>'+this.x.toFixed(0) + ': ' +Highcharts.numberFormat(this.y,2)
      }
      }}
      };
  
  plotCounter++;
  
  if(plotCounter == 0) {

      var mean_series={name:'Average', data:[], lineWidth:2, marker:{enabled:false}, color:'#ff0033', zIndex:100};
      var min_max_series={name:'Min-Max',  data:[], type:'arearange',marker:{enabled:false},lineWidth:1, color:'#66ff00', zIndex:0, fillOpacity:0.5};
      var median_series={name:'Median', data:[], lineWidth:2, marker:{enabled:false}};
      var reference_series={name:'Period average', data:[], lineWidth:2, dashStyle:'LongDash', marker:{enabled:false}, color:'(#57d900'};
  
  } else {
  
      var mean_series={name:'Average '+LMECode, data:[], lineWidth:2, marker:{enabled:false}, color:'#cc00c6', zIndex:101};
      var min_max_series={name:'Min-Max '+LMECode,  data:[], type:'arearange',marker:{enabled:false},lineWidth:1, color:'#ffaf00', zIndex:1, fillOpacity:0.5};
      var median_series={name:'Median '+LMECode, data:[], clolor: '#57da00', lineWidth:2, marker:{enabled:false}};
      var reference_series={name:'Period average '+LMECode, data:[], lineWidth:2, dashStyle:'LongDash', marker:{enabled:false}, color:'#e79e00'};
  
  }
  
  $.get('DATA_FILE_FULL_PATH', function(data) {
 
     var lines = data.split('\n');
	 var plotLME={};
             iplot=0;

			 
     $.each(lines, function(lineNo, line) {
		if (line) { // ignore empty line (else lines are not drawn)
          var items = line.split(' ');
  
          if (lineNo != 0) {
             min_max_series.data.push( [ parseFloat(items[0]), parseFloat(items[1]), parseFloat(items[2])  ] )
             median_series.data.push( [parseFloat(items[0]), parseFloat(items[3]) ] );
             reference_series.data.push( [parseFloat(items[0]), parseFloat(items[5])] );
			 mean_series.data.push( [parseFloat(items[0]), parseFloat(items[4])] );
        }
       }
  });
  
  if (plotCounter == 0) {
    options.series.push(min_max_series);
	options.series.push(mean_series);
	options.series.push(reference_series);
	options.series.push(median_series);	
  
  /*if (LMECode != thisLMECode) {
	chart.destroy();
  }*/
  chart = new Highcharts.Chart(options);
  } else {
	chart.addSeries(min_max_series);
	chart.addSeries(mean_series);
	chart.addSeries(median_series);
	chart.addSeries(reference_series);
  }
  
  });
  
 }
 var chart = false;
 //end f
 //Init Chart
 genChart(thisLMECode, true);

	    //add the jquery search
	    $(function() {
		var availableTags=[
        "01 East Bering Sea", "02 Gulf of Alaska", "03 California Current", "04 Gulf of California", "05 Gulf of Mexico",
        "06 Southeast U.S. Continental Shelf", "07 Northeast U.S. Continental Shelf", 
	"08 Scotian Shelf", "09 Newfoundland-Labrador Shelf",
        "10 Insular Pacific-Hawaiian", "11 Pacific Central-American Coastal","12 Caribbean Sea", "13 Humboldt Current",
	"14 Patagonian Shelf",
	"15 South Brazil Shelf",
	"16 East Brazil Shelf",
        "17 North Brazil Shelf","18 West Greenland Shelf","19 Iceland Shelf",
        "20 Barents Sea",
	"21 Norwegian Sea","22 North Sea","23 Baltic Sea",
        "24 Celtic-Biscay Shelf","25 Iberian Coastal","26 Mediterranean Sea",
        "27 Canary Current","28 Guinea Current","29 Benguela Current",
        "30 Agulhas Current","31 Somali Coastal Current","32 Arabian Sea",
        "33 Red Sea",
	"34 Bay of Bengal","35 Gulf of Thailand",
        "36 South China Sea","37 Sulu-Celebes Sea",
        "38 Indonesian Sea","39 North Australian Shelf",
        "40 Northeast Australian Shelf","41 East-Central Australian Shelf",
        "42 Southeast Australian Shelf","43 Southwest Australian Shelf",
        "44 West-Central Australian Shelf","45 Northwest Australian Shelf",
        "46 New Zealand Shelf",
	"47 East China Sea","48 Yellow Sea","49 Kuroshio Current",
        "50 Sea of Japan / East Sea","51 Oyashio Current",
	"52 Sea of Okhotsk","53 West Bering Sea",
        "54 Chukchi Sea",
	"55 Beaufort Sea","56 East Siberian Sea",
	"57 Laptev Sea","58 Kara Sea",
	"59 East Greenland Shelf","60 Faroe Plateau",
	"61 Antarctic",
	"62 Black Sea" 
	,"63 Hudson Bay"
//,"64 Arctic Ocean"
	];

/* ADDED */
			$('#addPlot')
			.click(function(){
				$('#resetPlot').attr('disabled', false);
				$('#tags').attr('disabled', true);
				$('#tags').focus();
				addedLMECode = $('#addPlot').attr('rel');
				genChart(addedLMECode);
				$(this).attr('disabled', true);
				$('#tags').prop('value', maxComboText);
			});
			$('#resetPlot')
				.click(function(){
					plotCounter = -1;
					genChart(thisLMECode);
					//console.log(self);
					//self.history.go(0);
					/*while(chart.series.length > 4){
						chart.series[0].remove(true);
					}*/
					$('#tags').attr('disabled', false);
					$('#tags').prop('value','');
					$('#tags').focus();
					$(this).attr('disabled', true);
				});
			
			
			var comboText = "Type LME code or name";
			var maxComboText = 'Maximum number of datasets reached';
			$( "#tags" ).css('color', '#c0c0c0');
/* END */
			$( "#tags" )
/* ADDED */			
			.click(function(){
				if(this.value == comboText){
					this.value = "";
					$( "#tags" ).css('color', '#000000');
				}
			})
			.blur(function(){
				if(this.value ==""){
					$( "#tags" ).css('color', '#c0c0c0');
					$('#addPlot').attr('disabled', true);
					this.value = comboText;
				}
			})
/* END */	.autocomplete({
              source: availableTags,
			  open: function(e, ui) {
                    var list = '';
                    var results = $('ul.ui-autocomplete.ui-widget-content a');
                    results.each(function() {
                        list += $(this).html() + '<br />';
                    });
                    $('#results').html(list);
                },
              select: function(e, ui) {
                  var lmename = ui.item.value.split(' ');
                  var lmecode = lmename.shift();
                  $('#addPlot').attr('rel',lmecode);
				  //document.getElementById('addPlot').innerHTML=lmecode;
/* ADDED */				  
				  document.getElementById('addPlot').disabled = false;
				  
/* END */				  
	          addedLMECode=lmecode;
              }
            });
	    });

      }); //get
   
  </script>

</head>
  <body>
<!-- ADDED -->
      <div class="ui-widget" style="margin:auto; width:500px">
	<input id="tags" class="autocomplete" style="width:320px; z-index:999 !important; float:left;" value="Type LME code or name"/>
	<div id="#results" class="ui-front autocomplete" style="z-index:999 !important" ></div>
	<input id="addPlot" type="button" value="add LME" disabled="disabled"></input>
	<input id="resetPlot" type="button" value="Reset plot" disabled="disabled"></input>
      </div>
<!-- END -->
  
    <div id="container" style="min-width:310px; max-width:600px; height:400px; margin:0 auto"></div>
    
    </body>
</html>
