<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="Cache-Control" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>
    <title>LMES CHLA</title>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script type="text/javascript" src="http://code.highcharts.com/highcharts.js"></script>
    <script type="text/javascript" src="http://code.highcharts.com/modules/exporting.js"></script>
    <script type="text/javascript" src="http://code.highcharts.com/highcharts-more.js"></script>
    <script src="/iframes/common/js/lmes.js"></script>
	<style>
      .ui-autocomplete{max-height:100px, overflow-y:auto;overflow-x:hidden;}
      html .ui-autocomplete{height:100px} /* IE6 does not support max-height */
      .ui-widget{font-size:12px;}
	  #viewData {
		font-family: Verdana;
		font-size: 10px;
		cursor: pointer;
	  }
	  .highcharts-tooltip span {
		background-color:white;
		z-index:9999!important;
		border: thin solid #333333;
		margin:0;
		padding: 7px;
		top: 0;
		left:0;
		position: relative;
		
	}
	#legendRanges{
		width: 600px;
		margin:auto auto;
	}
	#legendRanges ul{
		margin: 0;
		padding: 0;
		list-style-type: none;
		text-align: center;
	}
	#legendRanges ul li{
		float:left;
		padding-left:20px;
		font: 12px Verdana;
	}
	#legendRanges ul li div{
		float:left;
		margin-right:10px;
	}
	#legendRanges ul li div span{
		position:relative;
		top:5px;
	}
    </style>
    <script type="text/javascript">
      $(document).ready(function() {
	  //if (!console){ var console = { log: function() {}};}
	  
  
         var thisLMECode = THISLMECODETOREPLACE;
        var addedLMECode = -1;
		var plotCounter = -1;
		var categoryPlots = [thisLMECode];
		var outdata = '../'+THISLMEOUTDATA+'/data.csv';		
		
		Highcharts.SVGRenderer.prototype.symbols.cross = function (x, y, w, h) {
        return ['M', x, y, 'L', x + w, y + h, 'M', x + w, y, 'L', x, y + h, 'z'];
    };
    if (Highcharts.VMLRenderer) {
        Highcharts.VMLRenderer.prototype.symbols.cross = Highcharts.SVGRenderer.prototype.symbols.cross;
    }
		

		function genChart() {
			
		
		 var options = {
             credits:{enabled:false},
             chart: {
					renderTo: 'container',
					type: 'column',
					zoomType:'x',
                     resetZoomButton:{relativeTo:'chart',
					 position: {
						align:'right',
						verticalAlign: 'bottom',
						x:-10,
						y:-75},
                     theme:{
						fill: 'white',
						stroke:'red',
						r:0,
						states:{
							hover:{
								fill:'#41739D',
								style:{
									color:'white'
								}
							}
						}
					}
				},
					events:{
						load: function () {
						var chart = this,
							legend = chart.legend;

							for (var i = 0, len = legend.allItems.length; i < len; i++) {
								var item = legend.allItems[i].legendItem;
								item.on('mouseover', function (e) {
									//show custom tooltip here
									showLegendTooltip(this);
								}).on('mouseout', function (e) {
									//hide tooltip
									hideLegendTooltip();
								});
							}
						}
					}
             },
			legend:{align:'center', layout:'horizontal', width:480, itemStyle:{'font-weight': 'normal', 'max-width':'125'}, x:20},
             title: { text: 'Governance Indicators (CHARTTITLETOREPLACE)', x: 0, useHTML: true, align: 'center', style: {font: '14px Verdana, sans-serif', color: '#000000'} },
             xAxis: { type: 'linear', title:{text:'LME number'}, categories: categoryPlots},
             yAxis: { title: { text: 'Indicator values' , useHTML:true}, floor:0 },
             series: [],
			 
             plotOptions:{
				column:{
					animation:false,
					events: {
						legendItemClick: function () {
							return false;
						}
					},
					dataLabels:{
						enabled: true,
						align: 'top',
						useHTML: true,
						formatter:function(){
							if(this.y){
								var res = options.series[this.series._i+1].data[categoryPlots.indexOf(this.x)];
								//var console = { log: function() {}};
								//console.log(res);
							} else {
								var res = '5';
							}
							if(res == 5){ res='5';}
							switch(res){
								case '5':
									var color = '#D8232A';
									break;
								case '4':
									var color = '#EE9F42';
									break;
								case '3':
									var color = '#E4E344';
									break;
								case '2':
									var color = '#78BB4B';
									break;
								case '1':
									var color = '#5FBADD';
									break;
							}
							var cWidth = this.point.pointWidth;
							cWidth = cWidth-(cWidth/5);
							var fSize = cWidth/1.5;
							var top = fSize/5;
							
							res = '<div style="border-radius:50%; width:'+cWidth+'px; height:'+cWidth+'px; padding:0px; background:'+color+'; border: 1px solid #CBCCCB; color:#FFFFFF; text-align:center; font: '+fSize+'px Arial, sans-serif;"><span style="margin: auto auto; position:relative; top:'+top+'px">'+res+'</span></div>';
							return res;
						}
					}
				}
			 },
			 tooltip:{
				valueDecimals: 1,
				borderWidth:0,
				borderRadius:0,
				shadow:false,
				background: 'argb(255,255,255,0)',
				useHTML: true,
				style: {'z-index':9999999},
				positioner: function (labelWidth, labelHeight, point) {
					return { x: point.plotX, y: point.plotY-20 };
				},
				formatter: function() {
					var tt = this.point.category+" ";
					jQuery.each(availableTags, function(index, value){
						if(value.indexOf(tt) != -1){
							tt = value;
						}
					});
					return '<div class="tooltip"><b>LME '+tt+'</b><br />'+this.point.series.name+': '+this.y.toFixed(0)+'</div>';
				}
             }};

  
  
  
  
  plotCounter++;
  
  var eng={name:'Engagement', data:[], color: lineColors[0]};
  var engRisk={name:'Engagement Risk', data:[], color: lineColors[0], linkedTo:':previous', visible: false};
  var comp={name:'Completeness', data:[], color: lineColors[1]};
  var compRisk={name:'Completeness Risk', data:[], color: lineColors[1], linkedTo:':previous', visible: false};
  var inte={name:'Integration', data:[], color: lineColors[2]};
  var inteRisk={name:'Integration Risk', data:[], color: lineColors[2], linkedTo:':previous', visible: false};
  
  
  var rand = Math.floor(Math.random()*999999999);
  $.get(outdata+'?uid='+rand, function(data) {
 
 
     var lines = data.split('\n');
	 var plotLME={};
             iplot=0;
	 $.each(lines, function(lineNo, line) {
		if (line) { // ignore empty line (else lines are not drawn)
          var items = line.split(',');
  
        for(var u=0;u<categoryPlots.length;u++){	
			if(items[0] == categoryPlots[u]){
				eng.data.push(parseFloat(items[2]));
				engRisk.data.push(items[3]);
				comp.data.push(parseFloat(items[4]));
				compRisk.data.push(items[5]);
				inte.data.push(parseFloat(items[6]));
				inteRisk.data.push(items[7]);
			}
		}
       }
	 });
	
	options.series.push(eng);
	options.series.push(engRisk);
	options.series.push(comp);
	options.series.push(compRisk);
	options.series.push(inte);
	options.series.push(inteRisk);
	
	
	
	if(chart != false) {
		chart.destroy();
	}
		chart = new Highcharts.Chart(options);
  
 });
 }
 var chart = false;
 //end f
 //Init Chart
 genChart(thisLMECode, true);
 
 function showLegendTooltip(item){
	var itemText = '';
	switch ($(item).html()){
		case 'Engagement':
			itemText = 'Engagement: the level of engagement of countries in the LME participating in arrangements that address the suite of identified transboundary issues within the LME';
			break;
		case 'Completeness':
			itemText = 'Completeness: the level of completeness of the structure of arrangements to address a given issue or issues;';
			break;
		case 'Integration':
			itemText = 'Integration: level of integration of institutions involved in addressing the suite of identified transboundary issues within the LME;';
			break;
		}
		$('#legendTooltip')
			.html(itemText)
			.css('display', 'block')
			.css('background', '#e2e2e2');
 
 }
 function hideLegendTooltip(){
	$('#legendTooltip').css('display', 'none');
 }
 
 
 $('#viewData').click(function(){
	window.parent.window.location = "http://onesharedocean.org/?q=data#331";
 });
 if (window.frameElement != null) {
		var iFrame = parent.document.getElementById(window.frameElement.getAttribute('id'));
		if(iFrame != null){
			iFrame.style.height = '550px';
		}
	}
 
	    //add the jquery search
	    $(function() {
		


			$('#addPlot')
			.click(function(){
				$('#resetPlot').attr('disabled', false);
				$('#tags').prop('value', '');
				$('#tags').focus();
				addedLMECode = $('#addPlot').attr('rel');
				categoryPlots.push(addedLMECode);
				genChart();
				
				if (plotCounter == 5) {
					$(this).attr('disabled', true);
					$('#tags').attr('disabled', true);
					$('#tags').prop('value', maxComboText);
				}
			});
			$('#resetPlot')
				.click(function(){
					plotCounter = -1;
					categoryPlots = [thisLMECode];
					genChart(thisLMECode);
					
					$('#tags').attr('disabled', false);
					$('#tags').prop('value','');
					$('#tags').focus();
					$(this).attr('disabled', true);
				});
			
			
			var comboText = "Type LME code or name";
			var maxComboText = 'Maximum number of datasets reached';
			$( "#tags" ).css('color', '#c0c0c0');

			$( "#tags" )
			
			.click(function(){
				if(this.value == comboText){
					this.value = "";
					$( "#tags" ).css('color', '#000000');
				}
			})
			.blur(function(){
				if(this.value ==""){
					$( "#tags" ).css('color', '#c0c0c0');
					$('#addPlot').attr('disabled', true);
					this.value = comboText;
				}
			})
			.autocomplete({
              source: availableTags,
			  open: function(e, ui) {
                    var list = '';
                    var results = $('ul.ui-autocomplete.ui-widget-content a');
                    results.each(function() {
                        list += $(this).html() + '<br />';
                    });
                    $('#results').html(list);
                },
              select: function(e, ui) {
                  var lmename = ui.item.value.split(' ');
                  var lmecode = lmename.shift();
                  $('#addPlot').attr('rel',lmecode);
				  //document.getElementById('addPlot').innerHTML=lmecode;
			  
				  document.getElementById('addPlot').disabled = false;
				  
				  
	          addedLMECode=lmecode;
              }
            });
	    });

LISTOFAVAILABLELMES
		
      }); //get
   
  </script>

</head>
  <body>

      <div class="ui-widget" style="margin:auto; width:500px">
	<input id="tags" class="autocomplete" style="width:320px; z-index:999 !important; float:left;" value="Type LME code or name"/>
	<div id="#results" class="ui-front autocomplete" style="z-index:999 !important" ></div>
	<input id="addPlot" type="button" value="add LME" disabled="disabled"></input>
	<input id="resetPlot" type="button" value="Reset plot" disabled="disabled"></input>
      </div>

	  
	  
  
    <div id="container" style="min-width:310px; max-width:600px; height:400px; margin:0 auto"></div>
	<div id="legendRanges">
	<ul>
		<li>Risk Level:&nbsp;&nbsp;&nbsp;</li>
		<li><div style="border-radius:50%; width:20px; height:20px; padding:0px; background:#5FBADD; border: 1px solid #CBCCCB; color:#FFFFFF; text-align:center; font: 10px Arial, sans-serif;"><span style="margin: auto auto;">1</span></div> Very High</li>
		<li><div style="border-radius:50%; width:20px; height:20px; padding:0px; background:#78BB4B; border: 1px solid #CBCCCB; color:#FFFFFF; text-align:center; font: 10px Arial, sans-serif;"><span style="margin: auto auto;">2</span></div> High</li>
		<li><div style="border-radius:50%; width:20px; height:20px; padding:0px; background:#E4E344; border: 1px solid #CBCCCB; color:#FFFFFF; text-align:center; font: 10px Arial, sans-serif;"><span style="margin: auto auto;">3</span></div> Medium</li>
		<li><div style="border-radius:50%; width:20px; height:20px; padding:0px; background:#EE9F42; border: 1px solid #CBCCCB; color:#FFFFFF; text-align:center; font: 10px Arial, sans-serif;"><span style="margin: auto auto;">4</span></div> Low</li>
		<li><div style="border-radius:50%; width:20px; height:20px; padding:0px; background:#D8232A; border: 1px solid #CBCCCB; color:#FFFFFF; text-align:center; font: 10px Arial, sans-serif;"><span style="margin: auto auto;">5</span></div> Very Low</li>
	
	</ul>
	</div>
    <div style="text-align:right"><span id="viewData">Get data and metainformation</span></div>
	<div style="clear:both; font: 12px Verdana, sans-serif; padding:5px;" id="legendTooltip"></div>
    </body>
</html>
