<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="Cache-Control" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>
    <title>LMES Nutrients</title>
    <link rel="stylesheet" type="text/css" media="screen" href="/sites/all/libraries/jqGrid/css/ui.jqgrid.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="/sites/all/libraries/jqGrid/css/smoothness/jquery-ui-1.10.4.custom.css" />
	
	<script type="text/javascript" src="/sites/all/libraries/jqGrid/js/jquery-1.11.0.min.js"></script>
	<script type="text/javascript" src="/sites/all/libraries/jqGrid/js/jquery.jqGrid.src.js"></script>
	<script type="text/javascript" src="http://code.highcharts.com/highcharts.js"></script>
    <script type="text/javascript" src="http://code.highcharts.com/modules/exporting.js"></script>
    <script type="text/javascript" src="http://code.highcharts.com/highcharts-more.js"></script>
	<script src="/iframes/common/js/lmes.js"></script>
    
    <script type="text/javascript">
      $(document).ready(function() {
  
		var thisLMECode = "THISLMECODETOREPLACE";
		var thisLMEtitle = "ICEP CHARTTITLETOREPLACE";
		var outdata = "/public_store/lmes_nutrients/data/LME_NEWSRH2000_Nutrients_and_ICEP.csv";
		var chartData = [];
		var plotCounter = -1;
		var selectedPlots = [parseInt(thisLMECode)];
		var chart = false;
		
		
		
        
	var rand = Math.floor(Math.random()*999999999);
  $.get(outdata+'?uid='+rand, function(data) {
 
 
     var lines = data.split('\n');
	 chartData = lines;
	 
	 var tableData=[];
             iplot=0;
	 $.each(lines, function(lineNo, line) {
		if (line) { // ignore empty line (else lines are not drawn)
          var items = line.split(';');
  
          if (lineNo > 1) {
		  
			tableData.push({
			lme: items[0],
			stn: items[1],
			din: items[2],
			don: items[3],
			pn: items[4],
			dip: items[5],
			dop: items[6],
			pp: items[7],
			dsi: items[8],
			qact: items[9],
			np: items[10],
			icep: items[11],
			icepn: items[12],
			icepp: items[13]
			});
		}
       }
	 });
	 
	


 
$("#list").jqGrid({
	datatype: "local",
	height: 250,
   	colNames:['LME','STN basin<br />count', 'DIN<br />Tg/yr', 'DON<br />Tg/yr','PN<br />Tg/yr','DIP<br />Tg/yr','DOP<br />Tg/yr', 'PP<br />Tg/yr', 'Dis-SI<br />Tg/yr', 'Qact<br />km<sup>3</sup>/yr', 'N:P', 'ICEP', 'N-ICEP', 'P-ICEP'],
   	colModel:[
   		{name:'lme',index:'lme', width:20, align:"right", sorttype:"int"},
		{name:'stn',index:'stn', width:50, align:"right", sorttype:"float", hidden: true},
		{name:'din',index:'din', width:35, align:"right", sorttype:"float", hidden: true},
		{name:'don',index:'don', width:35, align:"right", sorttype:"float", hidden: true},
		{name:'pn',index:'pn', width:35, align:"right", sorttype:"float", hidden: true},
		{name:'dip',index:'dip', width:35, align:"right", sorttype:"float", hidden: true},
		{name:'dop',index:'dop', width:35, align:"right", sorttype:"float", hidden: true},
		{name:'pp',index:'pp', width:35, align:"right", sorttype:"float", hidden: true},
		{name:'dsi',index:'dsi', width:35, align:"right", sorttype:"float", hidden: true},
		{name:'qact',index:'qact', width:35, align:"right", sorttype:"float", hidden: true},
		{name:'np',index:'np', width:35, align:"right", sorttype:"float", hidden: true},
		{name:'icep',index:'icep', width:40, align:"right", sorttype:"float"},
		{name:'icepn',index:'icepn', width:40, align:"right", sorttype:"float"},
		{name:'icepp',index:'icepp', width:40, align:"right", sorttype:"float"},
	],
   	multiselect: true,
	loadonce: true,
	caption: "Add other LMEs",
	scrollrows: true,
	rowNum: 66,
	hiddengrid: true,
	sortable: true,
	viewrecords: true,
	sortname: "lme",
	sortorder: "asc",
	gridComplete: function(){
		if((navigator.sayswho == "MSIE 7") || (navigator.sayswho == "MSIE 8") || (navigator.sayswho == "MSIE 9")){
			$('#gbox_list').css('display', 'inline');
		} else {
			$('#gbox_list').css('display', 'inline-block');
			
		}
	},
	onHeaderClick: function(gs){
		var iFrame = null;
		if (window.frameElement != null) {
			iFrame = parent.document.getElementById(window.frameElement.getAttribute('id'));
		}
		var iFh = 0;
		if(iFrame){
			iFh = "500px";
		}
		
	
		if(gs == 'visible'){
			
			if((navigator.sayswho == "MSIE 7") || (navigator.sayswho == "MSIE 8") || (navigator.sayswho == "MSIE 9")){
				$('#colsDiv').css('display', 'inline');
			} else {
				$('#colsDiv').css('display', 'inline-block');
			}
			if(iFh != 0){
				iFrame.style.height = '780px';
			}
		}else{
			$('#colsDiv').css('display', 'none');
			if(iFh != 0){
				iFrame.style.height = '500px';
			}
		}
		if(selectedPlots.length == 0){
			selectedPlots = [parseInt(thisLMECode)];
		}
		$(this).setSelection(selectedPlots);
	},
	onSelectRow: function(id){
		var temp = $(this).jqGrid('getGridParam','selarrrow');
		if(temp.length > 0){
			//Regenerate the chart
			selectedPlots = [];
			for (var i=0; i<temp.length;i++){
				selectedPlots.push(parseInt(temp[i]));
			}
		}
		selectedPlots.sort();
		genChart();
		
	}
});
for(var ii=0;ii<=tableData.length;ii++){
	$("#list").addRowData(ii+1,tableData[ii]);
}
 
 
 $('.ck').change(function (){
 	if($(this).is(":checked")){
		$('#list').jqGrid("showCol",[$(this).attr('id')]);
	}else{
		$('#list').jqGrid("hideCol",[$(this).attr('id')]);
	}
});
	
	$("#reset").click(function(){
		$('#list').resetSelection();
		$('.ck').each(function(n, e){
			if($(e).is(':checked') ==  true){
				if((e.id != 'icep') && (e.id != 'icepn') && (e.id != 'icepp')){
					$(e).click();
				}
			} else {
				if((e.id == 'icep') || (e.id == 'icepn') || (e.id == 'icepp')){
					$(e).click();
				}
			}
		});
		$('#list').setSelection(parseInt(thisLMECode)); 
	

	});

 //Init Chart
 
 genChart();
	
}); //get data
	
	function genChart() {
		var categoryPlots = [];
		for (var i=0;i<selectedPlots.length;i++){
			categoryPlots.push(selectedPlots[i]);
		}
	
		
		 var options = {
             credits:{enabled:false},
             chart: {renderTo: 'container', type: 'column', zoomType:'x', 
                     resetZoomButton:{relativeTo:'chart', position: {align:'right', verticalAlign: 'bottom', x:-10, y:-75},
                     theme:{fill: 'white', stroke:'red', r:0, states:{hover:{fill:'#41739D', style:{color:'white'}}}}
                    }
             },
			legend:{align:'center', layout:'horizontal', itemStyle:{'font-weight': 'normal', 'max-width':'125'}},
             title: { text: thisLMEtitle, x: 0, useHTML: true, align: 'center', style: {font: '14px Verdana, sans-serif', color: '#000000'} },
             xAxis: { type: 'linear', title:{enabled:false}, categories: categoryPlots},
             yAxis: { title: { text: 'kg.C.km<sup>-2</sup>.day<sup>-1</sup>' , useHTML:true} },
             series: [],
             plotOptions:{series:{animation:false}},
			 tooltip:{valueDecimals: 2, formatter: function() {
				var tt = this.point.category+" ";
					jQuery.each(availableTags, function(index, value){
						if(value.indexOf(tt) != -1){
							tt = value;
						}
					});
				return 'LME '+tt+'<br />'+this.point.series.name+': '+this.y.toFixed(2)+'</b>';
				}
             }};

  

  var icep_series={name:'ICEP', data:[], color: lineColors[0]};
  var icepn_series={name:'N-ICEP', data:[], color: lineColors[1]};
  var icepp_series={name:'P-ICEP', data:[], color: lineColors[2]};
  
  
  
	$.each(chartData, function(lineNo, line) {
		if (line) { // ignore empty line (else lines are not drawn)
          var items = line.split(';');
		  if (lineNo > 1) {
		  
		  if ($.inArray(parseInt(items[0]), selectedPlots) !== -1){
		  
				icep_series.data.push(parseFloat(items[11]));
				icepn_series.data.push(parseFloat(items[12]));
				icepp_series.data.push(parseFloat(items[13]));
			}
			
		}
       }
	 });
	 

    options.series.push(icep_series);
	options.series.push(icepn_series);
	options.series.push(icepp_series);
	
	
	
	if(chart != false) {
		chart.destroy();
	}
		chart = new Highcharts.Chart(options);
	
	
 } //end function
 
 var iFrame = null;
	if (window.frameElement != null) {
		iFrame = parent.document.getElementById(window.frameElement.getAttribute('id'));
		iFrame.style.height = '500px';
	}
 $('#viewData').click(function(){
	window.parent.window.location = "http://onesharedocean.org/?q=data#241";
 });
 

 navigator.sayswho= (function(){
    var ua= navigator.userAgent, tem, 
    M= ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
    if(/trident/i.test(M[1])){
        tem=  /\brv[ :]+(\d+)/g.exec(ua) || [];
        return 'IE '+(tem[1] || '');
    }
    if(M[1]=== 'Chrome'){
        tem= ua.match(/\bOPR\/(\d+)/)
        if(tem!= null) return 'Opera '+tem[1];
    }
    M= M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];
    if((tem= ua.match(/version\/(\d+)/i))!= null) M.splice(1, 1, tem[1]);
    return M.join(' ');
})();
 
 
	
 }); //ready
 </script>
<style type="text/css" media="screen">
th.ui-th-column div{
	white-space:normal !important;
	height:auto !important;
	padding:2px;
}
	.ui-jqgrid .ui-jqgrid-view {
		font-size: 8px;
}
#main{
	font-family: Helvetica, Arial, sans-serif;
	font-size: 10px;
}
#gbox_list{
	/*display:inline;*/
	zoom: 1;
	vertical-align:top;
}
#colsDiv{
	text-align: left;
	zoom: 1;
}
#cols{
	padding: 0;
	margin: 0;
}
#cols li{
	list-style-type: none;
}
#down{
	text-align: center;
	vertical-align:top;
}
#cb_list{
	display:none;
}
#viewData {
	font-family: Verdana;
	font-size: 10px;
	cursor: pointer;
}
</style>
</head>
  <body>

  
  
<div id="main">
	<div id="container" style="min-width:310px; max-width:600px; height:400px; margin:0 auto"></div>
	<div style="text-align:right"><span id="viewData">Get data and metainformation</span></div>
	<div id="down">
		
			<table id="list"></table>
			<div id="colsDiv" style="display: none">
			<ul id="cols">
				<li><input type="button" id="reset" value="reset" />
				<li><input type="checkbox" id="stn" class="ck">STN basin count</input></li>
				<li><input type="checkbox" id="din" class="ck">DIN (Tg/year)</input></li>
				<li><input type="checkbox" id="don" class="ck">DON (Tg/year)</input></li>
				<li><input type="checkbox" id="pn" class="ck">PN (Tg/year)</input></li>
				<li><input type="checkbox" id="dip" class="ck">DIP (Tg/year)</input></li>
				<li><input type="checkbox" id="dop" class="ck">DOP (Tg/year)</input></li>
				<li><input type="checkbox" id="pp" class="ck">PP (Tg/year)</input></li>
				<li><input type="checkbox" id="dsi" class="ck">Dis-SI (Tg/year)</input></li>
				<li><input type="checkbox" id="qact" class="ck">Qact (km<sup>3</sup>/year)</input></li>
				<li><input type="checkbox" id="np" class="ck">N:P molar ratio</input></li>
				<li><input type="checkbox" id="icep" class="ck" checked="checked">ICEP (kg.C.km<sup>-2</sup>.day<sup>-1<)</input></li>
				<li><input type="checkbox" id="icepn" class="ck" checked="checked">N-ICEP (kg.C.km<sup>-2</sup>.day<sup>-1<)</input></li>
				<li><input type="checkbox" id="icepp" class="ck" checked="checked">P-ICEP (kg.C.km<sup>-2</sup>.day<sup>-1<)</input></li>
			</div>
		</div>
	</div>
</div>
</body>
</html>