<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title></title>
	
	<script src="http://onesharedocean.org/sites/all/libraries/jquery-1.11.0.js"></script>
	<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
	<script src="http://openlayers.org/api/OpenLayers.js"></script>
	<script src="/iframes/common/iframes/js/lmes.js"></script>

	<link rel="stylesheet" href="http://onesharedocean.org/geoserver/openlayers/theme/default/style.css" type="text/css">
	<link rel="stylesheet" href="http://onesharedocean.org/sites/all/libraries/accordion/lmes_accordion.css" type="text/css">
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" type="text/css">

<style type="text/css">
	.ui-front{
		z-index: 9999999999 !important;
		cursor: pointer;
		font-family:sans-serif; font-size:12px;
	}
	#ui-id-1{
		max-height:300px;
		overflow-y: auto;
		overflow-x: hidden;
	}

	#buttonLMEs {
		-moz-box-shadow: 0px 1px 0px 0px #ffffff;
		-webkit-box-shadow: 0px 1px 0px 0px #ffffff;
		box-shadow: 0px 1px 0px 0px #ffffff;
		background-color:#ededed;
		-webkit-border-top-left-radius:0px;
		-moz-border-radius-topleft:0px;
		border-top-left-radius:0px;
		-webkit-border-top-right-radius:0px;
		-moz-border-radius-topright:0px;
		border-top-right-radius:0px;
		-webkit-border-bottom-right-radius:0px;
		-moz-border-radius-bottomright:0px;
		border-bottom-right-radius:0px;
		-webkit-border-bottom-left-radius:0px;
		-moz-border-radius-bottomleft:0px;
		border-bottom-left-radius:0px;
		text-indent:0;
		border:1px solid #dcdcdc;
		display:inline-block;
		color:#777777;
		font-family:sans-serif;
		font-size:10px;
		font-weight:normal;
		font-style:normal;
		height:40px;
		line-height:40px;
		width:100px;
		text-decoration:none;
		text-align:center;
		text-shadow:1px 1px 0px #ffffff;
	}
	#b:hover {
		background-color:#dfdfdf;
		vertical-align:middle;
	}
	#buttonLMEs:active {
		position:relative;
		top:1px;
	}
</style>

<script type="text/javascript">
  
  $(function() {
		var comboText = "Search for an LME or click on the map";
		$('#deleteTags')
		.click(function(){
		$('#tags').attr('value', '');
		$('#tags').prop('value', '');
		$('#tags').focus();
		$('#buttonLMEs').css('display', 'none');
		$('#deleteTags').css('display', 'none');
	})
	.mouseenter(function(){
		$('#deleteTags').attr('src', '/iframes/lmes/images/delete_red.png');
	});
	$('#deleteTags').mouseleave(function(){
	$('#deleteTags').attr('src', '/iframes/lmes/images/delete_gray.png');
	});
  
	$('#tags')
	.keyup(function(){
		//console.log($('#tags').attr('value'));
		if($('#tags').prop('value') == ""){
			$('#deleteTags').css('display','none');
			$('#buttonLMEs').css('display', 'none');
		}
	})
	.click(function(){
		if(this.value == comboText){
			this.value = "";
			$( "#tags" ).css('color', '#000000');
		}
	})
	.keypress(function(){
		$('#deleteTags').css('display','inline-block');
	})
	.blur(function(){
		if(this.value ==""){
			$( "#tags" ).css('color', '#c0c0c0');
			this.value = comboText;
			$('#deleteTags').css('display','none');
			$('#buttonLMEs').css('display', 'none');
		}
	})
	.autocomplete({
		source: availableTags,
		open: function(e, ui) {
			var list = '';
			var results = $('ul.ui-autocomplete.ui-widget-content a');
			results.each(function() {
				//list += $(this).html();
			});
			$('#results').html(list);
		},
		select: function(e, ui) {
			var lmename = ui.item.value.split(' ');
			var lmecode = lmename.shift();
			var lmenode=nodeCodes[parseInt(lmecode)];
			$('#buttonLMEs').attr('href','http://onesharedocean.org/?q=node/'+parseInt(lmeCodeToNode(lmecode)));
			$('#buttonLMEs').attr('target','_blank');
			$('#buttonLMEs').css("display", "inline-block");
		}
	});
});
  
</script>
  </head>
  <body>
    <div class="ui-widget" style="float:none; line-height:50px;">
      <input id="tags" style=" display:inline-block; width:250px; font-family:sans-serif; font-size:12px; border:1px solid #c0c0c0; color:#c0c0c0; vertical-align:middle" value="Search for an LME or click on the map"/>
      <img id="deleteTags" src="/iframes/lmes/images/delete_gray.png" title="Clear search box" style="display:none; vertical-align:middle;margin-right:20px" />
      <a id="buttonLMEs" style="vertical-align:middle; display:none;">Visit LME factsheet</a>
      <div id="results" class="ui-front autocomplete; "></div>
    </div>
    
    <div style="float:left">
      <div id="mapOL" style="width:750px; height:375px;"></div>
      <div id="legOL" style="clear:both; width:750px"></div>
    </div>
    
    <div id="accordion">
      <ul>
	<li><h3 style="margin-top: 6px;"><span onclick="showLayer('lmes');">LMEs</span></h3>
	</li>
	<li><h3><span>Productivity</span></h3>
	  <ul>
	    <li><span onclick="showLayer('chla');">Chlorophyll-A</span></li>
	    <li><span onclick="showLayer('pp_mean');" >Primary productivity (Mean)</span></li>
	    <li><span onclick="showLayer('pp_trend');" >Primary productivity (Trend)</span></li>
	    <li><span onclick="showLayer('sst_net_change');">SST net change</span></li>
	  </ul>
	</li>
	<li><h3><span>Fish &amp; Fisheries</span></h3>
	</li>
	<!--<li><h3><span>Pollution &amp; Ecosystem health</span></h3>
	    <ul>-->
	<li><h3><span>Pollution</span></h3>
	  <ul>
	    <li><span onclick="showLayer('icep');">ICEP</span></li>

<!--	    <li><span onclick="showLayer('icep_n');">ICEP-N</span></li>
	    <li><span onclick="showLayer('icep_p');">ICEP-P</span></li>
-->
	    <li><span onclick="showLayer('plasticsmicro');">Micro Plastics</span></li>
	    <li><span onclick="showLayer('plasticsmacro');">Macro Plastics</span></li>
	    <li><span onclick="showLayer('pops_ddt');">DDT score</span></li>
	    <li><span onclick="showLayer('pops_hch');">HCHs score</span></li>
	    <li><span onclick="showLayer('pops_pcb');">PCBs score</span></li>
	  </ul>
	</li>
	<li><h3><span>Ecosystem health</span></h3>
	  <ul>
	    <li><span onclick="showLayer('coral');">Coral reefs</span></li>
	    <li><span onclick="showLayer('mangroves');">Mangroves</span></li>
	    <li><span onclick="showLayer('cumulImpact');">Cumulative Impact</span></li>
	  </ul>
	</li>
	<!--</ul>
	    </li>-->
	<li><h3><span>Socio-economics</span></h3>
	  <ul>
	    <li><span onclick="showLayer('population');">Total population</span></li>
	    <li><span onclick="showLayer('ruralpopulation')">Rural population</span></li>
	    <li><span onclick="showLayer('urbanpopulation')">Urban population</span></li>
	  </ul>
	</li>
	<li><h3><span>Governance</span></h3>
	  <ul>
	    <li><span onclick="showLayer('govIntCat');">Integration categories</span></li>
	    <li><span onclick="showLayer('govEngCat');">Engagement Category</span></li>
	    <li><span onclick="showLayer('govEngScore');">Engagement Score</span></li>
	    <li><span onclick="showLayer('govIntScore');">Integration Score</span></li>
	    <li><span onclick="showLayer('govComplScore');">Completeness Score</span></li>
	  </ul>
	</li>
	<li><h3><span>General information</span></h3>
	  <ul>
	    <li><span onclick="showLayer('areas');">LMEs Area</span></li>
	  </ul>
	</li>
	<li style="background:#ffffff;height:20px;border:0px;margin:-5px">
	</li>
	<li style="background:#C19451;margin:-5px;padding:5px"><h3 style="margin:0; background:#C19451"><span onclick="parent.window.location = 'http://onesharedocean.org?q=node/232';">Global Comparative Assessment</span></h3>
	</li>
      </ul>	
    </div>
    
  </body>	
  <script>
    var extent = new OpenLayers.Bounds(-180,-90,180,90);
    var minResolution=360/$("#mapOL").width();
    var maxResolution=50/$("#mapOL").width();
    var numZoomLevels=5;
    var options = {restrictedExtent:extent, maxExtent:extent,
    minResolution:minResolution, maxResolution:maxResolution, numZoomLevels: numZoomLevels,
    controls:[new OpenLayers.Control.PanZoom(), new OpenLayers.Control.NavToolbar()]};

    var map = new OpenLayers.Map("mapOL", options);
    var WDL = false;
    var TILE=false;
    var STYLE='';
    var TSIZE=new OpenLayers.Size(256,256);
    var GWCLMES="http://onesharedocean.org/geoserver/lmes/gwc/service/wms";
    var GWCWORLD="http://onesharedocean.org/geoserver/general/gwc/service/wms";
    
    //Map of the world
    var worldtop=new OpenLayers.Layer.WMS(
    "Countries",
    //"http://onesharedocean.org/geoserver/general/wms",
    GWCWORLD,
    {layers:"general:world_epsg4326", transparent:true, styles:'countries_lightyellow_noname'},
    {tiled:true, tileSize:TSIZE, isBaseLayer:true, visibility:true, opacity:1}
    );
    
    //LMEs
    var lmes = new OpenLayers.Layer.WMS(
    "LMES",
//    "http://onesharedocean.org/geoserver/lmes/wms",
    GWCLMES,
    {layers:"lmes:lmes66_pwp", transparent:true, styles:'', format:'image/png'},
    {layerId:'lmes', tiled:true, tileSize:TSIZE, isBaseLayer:false, opacity:1, visibility:true}
    );
    
    //Primary productivity
    var chla=new OpenLayers.Layer.WMS(
    "Chlorophyll-A",
//    "http://onesharedocean.org/geoserver/lmes/wms",
    GWCLMES,
    {layers:"lmes:lmes_chla_longterm",  transparent:true, styles:'lmes_chla_mean', format:'image/png'},
    {layerId:'chla', tiled:true, isBaseLayer:false, opacity:1, visibility:false, wrapDateLine:true}
    );

    var pp_mean=new OpenLayers.Layer.WMS(
    "PP_MEAN",
//    "http://onesharedocean.org/geoserver/lmes/wms",
    GWCLMES,
    {layers:"lmes:lmes_ppd_longterm_mean",  transparent:true, styles:'lmes_ppd_mean', format:'image/png'},
    {layerId:'pp_mean', tiled:true, isBaseLayer:false, opacity:1, visibility:false, wrapDateLine:true}
    );

    var pp_trend=new OpenLayers.Layer.WMS(
    "PP_TREND",
//    "http://onesharedocean.org/geoserver/lmes/wms",
    GWCLMES,
    {layers:"lmes:lmes_ppd_longterm_trend",  transparent:true, styles:'lmes_ppd_trend', format:'image/png'},
    {layerId:'pp_trend', tiled:true, isBaseLayer:false, opacity:1, visibility:false, wrapDateLine:true}
    );
    
    //SST net change
    var sst_net_change=new OpenLayers.Layer.WMS(
    "SST net change",
//    "http://onesharedocean.org/geoserver/lmes/wms",
    GWCLMES,
    {layers:"lmes:lmes_sst_change_1957_2012", transparent:true, styles:'lmes_sst_change', format:'image/png'},
    {layerId:'sst_net_change', tiled:true, isBaseLayer:false, opacity:1, visibility:false, wrapDateLine:true}
    );
    
    //Ecosystem
    //Coral reefs
    var coral = new OpenLayers.Layer.WMS(
    "Coral reefs",
//    "http://onesharedocean.org/geoserver/lmes/wms",
    GWCLMES,
    {layers:"lmes:lmes66_data",  styles:'lmes_data_coral', transparent:true, format:'image/png'},
    {layerId:'coral', singleTile:true, isBaseLayer:false, opacity:1, visibility:false, wrapDateLine:true}
    );
    
    // mangroves
    var mangroves=new OpenLayers.Layer.WMS(
    "Mangroves",
//    "http://onesharedocean.org/geoserver/lmes/wms",
    GWCLMES,
    {layers:"lmes:mangrovepercent_lmes66",  styles:'lmes_mangrovespercent', transparent:true, format:'image/png'},
    {layerId:'mangroves', singleTile:true, isBaseLayer:false, opacity:1, visibility:false, wrapDateLine:true}
    );
    
    //Areas
    var areas= new OpenLayers.Layer.WMS(
    "Areas",
//    "http://onesharedocean.org/geoserver/lmes/wms",
    GWCLMES,
    {layers:"lmes:lmes66_data",  styles:'LMES_data_area', transparent:true, format:'image/png'},
    {layerId:'areas', singleTile:true, isBaseLayer:false, opacity:1, visibility:false}
    );
    
    // Impacts
    var cumulImpact = new OpenLayers.Layer.WMS(
    "CumulImpact",
//    "http://onesharedocean.org/geoserver/lmes/wms",
    GWCLMES,
    {layers:"lmes:cumulImpact_LME66", styles:'lmes_cumulimpact', transparent:true, format:'image/png'},
    {layerId:'cumulImpact', singleTile:true, isBaseLayer:false, opacity:1, visibility:false}
    );
    
    // Socio eco: population
    var population = new OpenLayers.Layer.WMS(
    "Population",
    "http://onesharedocean.org/geoserver/lmes/wms",
    {layers:"lmes:population_LME66", styles:'lmes_population', transparent:true, format:'image/png'},
    {layerId:'population', singleTile:true, isBaseLayer:false, opacity:1, visibility:false}
    );
    
    var ruralpopulation = new OpenLayers.Layer.WMS(
    "Rural population",
    "http://onesharedocean.org/geoserver/lmes/wms",
    {layers:"lmes:population_LME66", styles:'lmes_ruralpopulation', transparent:true, format:'image/png'},
    {layerId:'ruralpopulation', singleTile:true, isBaseLayer:false, opacity:1, visibility:false}
    );
    
    var urbanpopulation = new OpenLayers.Layer.WMS(
    "Urban population",
    "http://onesharedocean.org/geoserver/lmes/wms",
    {layers:"lmes:population_LME66", styles:'lmes_urbanpopulation', transparent:true, format:'image/png'},
    {layerId:'urbanpopulation', singleTile:true, isBaseLayer:false, opacity:1, visibility:false}
    );
    
    var icep = new OpenLayers.Layer.WMS(
    "ICEP",
//    "http://onesharedocean.org/geoserver/lmes/wms",
    GWCLMES,
    {layers:"lmes:nutrients_icep_LMES66", styles:'lmes_nutrients_icep', transparent:true, format:'image/png'},
    {layerId:'icep', tiled:true, isBaseLayer:false, opacity:1, visibility:false}
    );
<!--
    var icepn = new OpenLayers.Layer.WMS(
    "ICEP N",
    "http://onesharedocean.org/geoserver/lmes/wms",
    {layers:"lmes:nutrients_icep_LMES66", styles:'lmes_nutrients_icep_n', transparent:true, format:'image/png'},
    {layerId:'icep_n', singleTile:true, isBaseLayer:false, opacity:1, visibility:false}
    );

    var icepp = new OpenLayers.Layer.WMS(
    "ICEP P",
    "http://onesharedocean.org/geoserver/lmes/wms",
    {layers:"lmes:nutrients_icep_LMES66", styles:'lmes_nutrients_icep_p', transparent:true, format:'image/png'},
    {layerId:'icep_p', singleTile:true, isBaseLayer:false, opacity:1, visibility:false}
    );
-->
    var plasticsModelMicroCount = new OpenLayers.Layer.WMS(
    "Micro plastics",
//    "http://onesharedocean.org/geoserver/lmes/wms",
     GWCLMES,
    {layers:"lmes:lmes_plastics_modeldistribution", styles:'lmes_plasticsdistr_5classes_micro_count', transparent:true, format:'image/png'},
    {layerId:'plasticsmicro', tiled:true, isBaseLayer:false, opacity:1, visibility:false}
    );

    var plasticsModelMacroWeight = new OpenLayers.Layer.WMS(
    "Macro plastics",
//    "http://onesharedocean.org/geoserver/lmes/wms",
     GWCLMES,
    {layers:"lmes:lmes_plastics_modeldistribution", styles:'lmes_plasticsdistr_5classes_macro_weight', transparent:true, format:'image/png'},
    {layerId:'plasticsmacro', tiled:true, isBaseLayer:false, opacity:1, visibility:false}
    );

    var governance_int_cat = new OpenLayers.Layer.WMS(
        "Integration Categories",
//        "http://onesharedocean.org/geoserver/lmes/wms",
        GWCLMES,
        {layers:"lmes:lme_governance_analysis_indicators", styles:'lmes_governance_integration_categories', transparent:true, format:'image/png'},
        {layerId:'govIntCat', tiled:true, isBaseLayer:false, opacity:1, visibility:false}
    );

    var governance_engt_score = new OpenLayers.Layer.WMS(
        "Engagement Score",
//        "http://onesharedocean.org/geoserver/lmes/wms",
       GWCLMES,
        {layers:"lmes:lme_governance_analysis_indicators", styles:'lmes_governance_engagement_score', transparent:true, format:'image/png'},
        {layerId:'govEngScore', tiled:true, isBaseLayer:false, opacity:1, visibility:false}
    );

    var governance_int_score = new OpenLayers.Layer.WMS(
        "Integration Score",
//        "http://onesharedocean.org/geoserver/lmes/wms",
       GWCLMES,
        {layers:"lmes:lme_governance_analysis_indicators", styles:'lmes_governance_integration_score', transparent:true, format:'image/png'},
        {layerId:'govIntScore', tiled:true, isBaseLayer:false, opacity:1, visibility:false}
    );

    var governance_compl_score = new OpenLayers.Layer.WMS(
        "Completeness Score",
//        "http://onesharedocean.org/geoserver/lmes/wms",
      GWCLMES,
        {layers:"lmes:lme_governance_analysis_indicators", styles:'lmes_governance_completeness_score', transparent:true, format:'image/png'},
        {layerId:'govComplScore', tiled:true, isBaseLayer:false, opacity:1, visibility:false}
    );

    var governance_engt_cat = new OpenLayers.Layer.WMS(
        "Engagement Categories",
//        "http://onesharedocean.org/geoserver/lmes/wms",
     GWCLMES,
        {layers:"lmes:lme_governance_analysis_indicators", styles:'lmes_governance_engagement_categories', transparent:true, format:'image/png'},
        {layerId:'govEngCat', tiled:true, isBaseLayer:false, opacity:1, visibility:false}
    );

    var pops_ddt = new OpenLayers.Layer.WMS(
        "DDT score",
        GWCLMES,
        {layers:"lmes:lmes_pops", styles:'lmes_pops_ddt', transparent:true, format:'image/png'},
        {layerId:'pops_ddt', tiled:true, tileSize:TSIZE, isBaseLayer:false, opacity:1, visibility:false}
    );

    var pops_hch = new OpenLayers.Layer.WMS(
        "HCHs score",
        GWCLMES,
        {layers:"lmes:lmes_pops", styles:'lmes_pops_hch', transparent:true, format:'image/png'},
        {layerId:'pops_hch', tiled:true, tileSize:TSIZE, isBaseLayer:false, opacity:1, visibility:false}
    );

    var pops_pcb = new OpenLayers.Layer.WMS(
        "DDT score",
        GWCLMES,
        {layers:"lmes:lmes_pops", styles:'lmes_pops_pcb', transparent:true, format:'image/png'},
        {layerId:'pops_pcb', tiled:true, tileSize:TSIZE, isBaseLayer:false, opacity:1, visibility:false}
    );

    //Add layers to map objects
    map.addLayers([
    worldtop, //always in first position
    lmes,
    chla,
    pp_mean,
    pp_trend,
    sst_net_change,
    coral,
    mangroves,
    areas,
    cumulImpact,
    population,
    ruralpopulation,
    urbanpopulation,
    icep,
    //icepn, icepp,
    plasticsModelMicroCount, plasticsModelMacroWeight,
    governance_int_cat, governance_engt_score, governance_int_score, governance_compl_score, governance_engt_cat,
    pops_ddt, pops_hch, pops_pcb
    ]);
    
    function showLayer(menuItem){
    for(var i=1; i<map.getNumLayers();i++){
		     var layerId = map.layers[i].layerId;
		     if(layerId == menuItem){
		     map.layers[i].setVisibility(true);
		     $('#leg-'+layerId).css('display', 'block');
		     } else {
		     map.layers[i].setVisibility(false);
		     $('#leg-'+layerId).css('display', 'none');
		     }
		     }
		     }
		     
		     map.zoomToMaxExtent();
		     
		     
		     var info = new OpenLayers.Control.WMSGetFeatureInfo({
		       url:GWCLMES, //'http://onesharedocean.org/geoserver/lmes/wms',
		       output:'features',
		       infoFormat:'application/vnd.ogc.gml',
		       format: new OpenLayers.Format.GML,
		       layers:[lmes],
		     
		       eventListeners: {
	                getfeatureinfo: function(event) {
	             
		         if (typeof(event.features[0])=='undefined'){return};
	                 LME_NUMBER=event.features[0].attributes.LME_NUMBER;
			 LME_NAME=event.features[0].attributes.LME_NAME;
			 $('#buttonLMEs').attr("href","http://onesharedocean.org/?q=node/"+parseInt(lmeCodeToNode(
				 LME_NUMBER)));
			 $('#buttonLMEs').attr("target","_blank");
			$('#buttonLMEs').css('display', 'inline-block');
			$('#tags').prop('value', LME_NUMBER+' '+LME_NAME);
			$('#tags').css('color', '#000000');
			$('#deleteTags').css('display', 'inline-block');
		     }
		     }
		     });
		     
		     map.addControl(info);
		     info.activate();
		     
		     </script>
  
  <script>
    $(document).ready(function(){
    $("#accordion h3").click(function(){
    //slide up all the link lists
    $("#accordion ul ul").slideUp(400, function(){
    var iFrame = parent.document.getElementById("iFrame");
    if($('#accordion').height() < iFrame.height-25){
				  iFrame.height = 600;
				  }
				  });
				  //slide down the link list below the h3 clicked - only if its closed
				  if(!$(this).next().is(":visible"))
				  {
				  $(this).next().slideDown(400, function(){
				  var iFrame = parent.document.getElementById("iFrame");
				  if($('#accordion').height() > iFrame.height){
      iFrame.height = $('#accordion').height()+25;
      }
      });
      }
      })
      });
      
  </script>
  <script>
    $.get("/iframes/lmes/maps/lmes_portal_legends.html", function(data){
    $('#legOL').html(data);
    });
    
    //Post-change of the controls position on the map
    $('#OpenLayers_Control_PanZoom_2').css('top','220px');
</script>
  
</html>
