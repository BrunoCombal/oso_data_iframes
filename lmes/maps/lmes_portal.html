<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title></title>
	
<script src="http://onesharedocean.org/sites/all/libraries/jquery-1.11.0.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script src="http://openlayers.org/api/OpenLayers.js"></script>

<link rel="stylesheet" href="http://onesharedocean.org/geoserver/openlayers/theme/default/style.css" type="text/css">
<link rel="stylesheet" href="http://onesharedocean.org/sites/all/libraries/accordion/lmes_accordion.css" type="text/css">
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" type="text/css">

<style type="text/css">
.ui-front{
	z-index: 9999999999 !important;
	cursor: pointer;
	font-family:sans-serif; font-size:12px;
}
#ui-id-1{
	max-height:300px;
	overflow-y: auto;
	overflow-x: hidden;
}

#buttonLMEs {
-moz-box-shadow: 0px 1px 0px 0px #ffffff;
-webkit-box-shadow: 0px 1px 0px 0px #ffffff;
box-shadow: 0px 1px 0px 0px #ffffff;
background-color:#ededed;
-webkit-border-top-left-radius:0px;
-moz-border-radius-topleft:0px;
border-top-left-radius:0px;
-webkit-border-top-right-radius:0px;
-moz-border-radius-topright:0px;
border-top-right-radius:0px;
-webkit-border-bottom-right-radius:0px;
-moz-border-radius-bottomright:0px;
border-bottom-right-radius:0px;
-webkit-border-bottom-left-radius:0px;
-moz-border-radius-bottomleft:0px;
border-bottom-left-radius:0px;
text-indent:0;
border:1px solid #dcdcdc;
display:inline-block;
color:#777777;
font-family:sans-serif;
font-size:10px;
font-weight:bold;
font-style:normal;
height:40px;
line-height:40px;
width:100px;
text-decoration:none;
text-align:center;
text-shadow:1px 1px 0px #ffffff;
}
#b:hover {
background-color:#dfdfdf;
vertical-align:middle;
}
#buttonLMEs:active {
position:relative;
top:1px;
}
	 </style>
	
    <script type="text/javascript">
        var availableTags = [
		"01 East Bering Sea", 
		"02 Gulf of Alaska", 
		"03 California Current", 
		"04 Gulf of California", 
		"05 Gulf of Mexico",
		"06 Southeast U.S. Continental Shelf", 
		"07 Northeast U.S. Continental Shelf", 
		"08 Scotian Shelf", 
		"09 Newfoundland-Labrador Shelf",
		"10 Insular Pacific-Hawaiian", 
		"11 Pacific Central-American Coastal",
		"12 Caribbean Sea",
		"13 Humboldt Current",
		"14 Patagonian Shelf",
		"15 South Brazil Shelf",
		"16 East Brazil Shelf",
		"17 North Brazil Shelf",
		"18 West Greenland Shelf",
		"19 Iceland Shelf",
		"20 Barents Sea",
		"21 Norwegian Sea",
		"22 North Sea",
		"23 Baltic Sea",
		"24 Celtic-Biscay Shelf",
		"25 Iberian Coastal",
		"26 Mediterranean Sea",
		"27 Canary Current",
		"28 Guinea Current",
		"29 Benguela Current",
		"30 Agulhas Current",
		"31 Somali Coastal Current",
		"32 Arabian Sea",
		"33 Red Sea",
		"34 Bay of Bengal",
		"35 Gulf of Thailand",
		"36 South China Sea",
		"37 Sulu-Celebes Sea",
		"38 Indonesian Sea",
		"39 North Australian Shelf",
		"40 Northeast Australian Shelf",
		"41 East-Central Australian Shelf",
		"42 Southeast Australian Shelf",
		"43 Southwest Australian Shelf",
		"44 West-Central Australian Shelf",
		"45 Northwest Australian Shelf",
		"46 New Zealand Shelf",
		"47 East China Sea",
		"48 Yellow Sea",
		"49 Kuroshio Current",
		"50 Sea of Japan / East Sea",
		"51 Oyashio Current",
		"52 Sea of Okhotsk",
		"53 West Bering Sea",
		"54 Chukchi Sea",
		"55 Beaufort Sea",
		"56 East Siberian Sea",
		"57 Laptev Sea",
		"58 Kara Sea",
		"59 East Greenland Shelf",
		"60 Faroe Plateau",
		"61 Antarctic",
		"62 Black Sea",
		"63 Hudson Bay",
		"64 Arctic Ocean",
		"65 Aleutian Islands",
		"66 Canadian High Arctic / North Greenland"
	    ];
		$(function() {
	    var comboText = "Search for an LME or click on the map";
		$('#deleteTags')
		.click(function(){
			$('#tags').attr('value', '');
			$('#tags').prop('value', '');
			$('#tags').focus();
			$('#buttonLMEs').css('display', 'none');
			$('#deleteTags').css('display', 'none');
		})
		.mouseenter(function(){
			$('#deleteTags').attr('src', '/iframes/lmes/images/delete_red.png');
		});
			$('#deleteTags').mouseleave(function(){
			$('#deleteTags').attr('src', '/iframes/lmes/images/delete_gray.png');
		});
		
		
		$('#tags')
		.keyup(function(){
			console.log($('#tags').attr('value'));
			if($('#tags').prop('value') == ""){
				$('#deleteTags').css('display','none');
				$('#buttonLMEs').css('display', 'none');
			}
		})
		.click(function(){
			if(this.value == comboText){
				this.value = "";
				$( "#tags" ).css('color', '#000000');
			}
		})
		.keypress(function(){
			$('#deleteTags').css('display','inline-block');
		})
		.blur(function(){
			if(this.value ==""){
				$( "#tags" ).css('color', '#c0c0c0');
				this.value = comboText;
				$('#deleteTags').css('display','none');
				$('#buttonLMEs').css('display', 'none');
			}
		})
		.autocomplete({
	      source: availableTags,
	      open: function(e, ui) {
	            var list = '';
	            var results = $('ul.ui-autocomplete.ui-widget-content a');
	            results.each(function() {
	                //list += $(this).html();
	            });
	            $('#results').html(list);
	        },
	      select: function(e, ui) {
              var lmename = ui.item.value.split(' ');
	          var lmecode = lmename.shift();
	          var lmenode=nodeCodes[parseInt(lmecode)];

	          $('#buttonLMEs').attr('href','http://onesharedocean.org/?q=node/'+parseInt(lmeCodeToNode(lmecode)));
	          $('#buttonLMEs').attr('target','_blank');
			  $('#buttonLMEs').css("display", "inline-block");
	      }
	    });
	  });
   
	
   </script>
	
</head>
<body>
<div class="ui-widget" style="float:none; line-height:50px;">
    <input id="tags" style=" display:inline-block; width:250px; font-family:sans-serif; font-size:12px; border:1px solid #c0c0c0; color:#c0c0c0; vertical-align:middle" value="Search for an LME or click on the map"/>
    <img id="deleteTags" src="/iframes/lmes/images/delete_gray.png" title="Clear search box" style="display:none; vertical-align:middle;margin-right:20px" />
	<a id="buttonLMEs" style="vertical-align:middle; display:none;">Visit LME factsheet</a>
	<div id="results" class="ui-front autocomplete; "></div>
</div>


<div style="float:left">
<div id="mapOL" style="width:750px; height:375px;"></div>
</div>

<div id="accordion">
  <ul>
    <li><h3 style="margin-top: 6px;"><span onclick="showLayer('lmes');">LMEs</span></h3>
    </li>
    <li><h3><span>Productivity</span></h3>
      <ul>
	<li><span onclick="showLayer('pp');">Primary productivity</span></li>
	<li><span onclick="showLayer('sst_net_change');">SST net change</span></li>
      </ul>
    </li>
    <li><h3><span>Fisheries</span></h3>
    </li>
    <li><h3><span>Pollution &amp; Ecosystems</span></h3>
      <ul>
	<li><span onclick="showLayer('coral');">Coral reefs</span></li>
	<li><span onclick="showLayer('mangroves');">Mangroves</span></li>
	<li><span onclick="showLayer('cumulImpact');">Cumulative Impact</span></li>
      </ul>
    </li>
    <li><h3><span>Socio-economics</span></h3>
      <ul>
	<li><span onclick="showLayer('population');">Total population</span></li>
	<li><span onclick="showLayer('ruralpopulation')">Rural population</span></li>
	<li><span onclick="showLayer('urbanpopulation')">Urban population</span></li>
      </ul>
    </li>
    <li><h3><span>General information</span></h3>
      <ul>
	<li><span onclick="showLayer('areas');">LMEs Area</span></li>
      </ul>
    </li>
  </ul>	
</div>
<div id="legOL" style="clear:both; width:750px"></div>
</body>	
    <script>
		var extent = new OpenLayers.Bounds(-180,-90,180,90);
		var minResolution=365/$("#mapOL").width();
		var maxResolution=0.5/$("#mapOL").width();
		var options = {restrictedExtent:extent, maxExtent:extent, minResolution:minResolution, maxResolution:maxResolution,
			controls:[new OpenLayers.Control.PanZoom(), new OpenLayers.Control.NavToolbar()]};

		nodeCodes={"1":"51", "2":"55", "3":"56", "4":"57", "5":"58", "6":"59", "7":"60", "8":"61", "9":"62", "10":"63",
		"11":"65", "12":"66", "13":"67", "14":"68", "15":"69", "16":"70", "17":"71", "18":"72", "19":"73", "20":"74",
		"21":"75", "22":"76", "23":"77", "24":"78", "25":"79", "26":"80", "27":"81", "28":"82", "29":"83", "30":"84", 
		"31":"85", "32":"86", "33":"87", "34":"88", "35":"89", "36":"90", "37":"91", "38":"92", "39":"93", "40":"94", 
		"41":"95", "42":"96", "43":"97", "44":"98", "45":"99", "46":"100", "47":"101", "48":"102", "49":"103", "50":"104", 
		"51":"105", "52":"106", "53":"107", "54":"108", "55":"109", "56":"110", "57":"111", "58":"112", "59":"113", "60":"114", 
		"61":"115", "62":"116", "63":"117", "64":"118", "65":"119", "66":"120"}; // LME_CODE:"nodeCode"

		var map = new OpenLayers.Map("mapOL", options);

		//Map of the world
		var worldtop=new OpenLayers.Layer.WMS(
			"Countries",
			"http://onesharedocean.org/geoserver/general/wms",
			{layers:"general:world_epsg4326", transparent:true,styles:'countries_lightyellow_noname', format:'image/png'},
			{singleTile:true, isBaseLayer:true, visibility:true, opacity:1}
		);
	
		//LMEs
		var lmes = new OpenLayers.Layer.WMS(
			"LMEs",
			"http://onesharedocean.org/geoserver/ocean/wms",
			{layers:"ocean:LME66", transparent:true, styles:'LMES_colors'},
			{layerId:'lmes', singleTile:true, isBaseLayer:false, opacity:1, visibility:true}
		);
	  
		//Primary productivity
		var pp=new OpenLayers.Layer.WMS(
			"PP",
            "http://onesharedocean.org/geoserver/lmes/wms",
            {layers:"lmes:lmes66_data",  transparent:true, styles:'lmes_data_pp', format:'image/png'},
            {layerId:'pp', singleTile:true, isBaseLayer:false, opacity:1, visibility:false, wrapDateLine:true}
        );
		
		//SST net change
		var sst_net_change=new OpenLayers.Layer.WMS(
		"SST net change",
		"http://onesharedocean.org/geoserver/lmes/wms",
		{layers:"lmes:lmes_sst_change_1957_2012", transparent:true, styles:'lmes_sst_change', format:'image/png'},
		{layerId:'sst_net_change',singleTile:true, isBaseLayer:false, opacity:1, visibility:false, wrapDateLine:true}
		);
		
		//Ecosystem
		//Coral reefs
		var coral = new OpenLayers.Layer.WMS(
		"Coral reefs",
		"http://onesharedocean.org/geoserver/lmes/wms",
		{layers:"lmes:lmes66_data",  styles:'lmes_data_coral', transparent:true, format:'image/png'},
		{layerId:'coral', singleTile:true, isBaseLayer:false, opacity:1, visibility:false, wrapDateLine:true}
		);

		// mangroves
		var mangroves=new OpenLayers.Layer.WMS(
		"Mangroves",
		"http://onesharedocean.org/geoserver/lmes/wms",
		{layers:"lmes:mangrovepercent_lmes66",  styles:'lmes_mangrovespercent', transparent:true, format:'image/png'},
		{layerId:'mangroves', singleTile:true, isBaseLayer:false, opacity:1, visibility:false, wrapDateLine:true}
		);
		
		//Areas
		var areas= new OpenLayers.Layer.WMS(
		"Areas",
		"http://onesharedocean.org/geoserver/lmes/wms",
		{layers:"lmes:lmes66_data",  styles:'LMES_data_area', transparent:true, format:'image/png'},
		{layerId:'areas', singleTile:true, isBaseLayer:false, opacity:1, visibility:false}
		);
		
		// Impacts
		var cumulImpact = new OpenLayers.Layer.WMS(
		"CumulImpact",
		"http://onesharedocean.org/geoserver/lmes/wms",
		{layers:"lmes:cumulImpact_LME66", styles:'lmes_cumulimpact', transparent:true, format:'image/png'},
		{layerId:'cumulImpact', singleTile:true, isBaseLayer:false, opacity:1, visibility:false}
		);
		
		
		// Socio eco: population
		var population = new OpenLayers.Layer.WMS(
		"Population",
		"http://onesharedocean.org/geoserver/lmes/wms",
		{layers:"lmes:population_LME66", styles:'lmes_population', transparent:true, format:'image/png'},
		{layerId:'population', singleTile:true, isBaseLayer:false, opacity:1, visibility:false}
		);


		var ruralpopulation = new OpenLayers.Layer.WMS(
		"Rural population",
		"http://onesharedocean.org/geoserver/lmes/wms",
		{layers:"lmes:population_LME66", styles:'lmes_ruralpopulation', transparent:true, format:'image/png'},
		{layerId:'ruralpopulation', singleTile:true, isBaseLayer:false, opacity:1, visibility:false}
		);

		var urbanpopulation = new OpenLayers.Layer.WMS(
		"Urban population",
		"http://onesharedocean.org/geoserver/lmes/wms",
		{layers:"lmes:population_LME66", styles:'lmes_urbanpopulation', transparent:true, format:'image/png'},
		{layerId:'urbanpopulation', singleTile:true, isBaseLayer:false, opacity:1, visibility:false}
		);


	    //Add layers to map objects
		map.addLayers([
		worldtop, //always in first position
		lmes,
		pp,
		sst_net_change,
		coral,
		mangroves,
		areas,
		cumulImpact,
		population,
		ruralpopulation,
		urbanpopulation
		]);
		
		function showLayer(menuItem){
			for(var i=1; i<map.getNumLayers();i++){
				var layerId = map.layers[i].layerId;
				if(layerId == menuItem){
					map.layers[i].setVisibility(true);
					$('#leg-'+layerId).css('display', 'block');
				} else {
					map.layers[i].setVisibility(false);
					$('#leg-'+layerId).css('display', 'none');
				}
			}
		}

		map.zoomToMaxExtent();

	    function lmeCodeToNode(code){
	      node=8; // page not found
	      node=nodeCodes[parseInt(code)];
	      return node;
	    };

	    var info = new OpenLayers.Control.WMSGetFeatureInfo({
	       url:'http://onesharedocean.org/geoserver/ocean/wms',
	       title:'identify feature by clicking',
	       output:'features',
	       infoFormat:'application/vnd.ogc.gml',
	       format: new OpenLayers.Format.GML,

	       eventListeners: {
	        getfeatureinfo: function(event) {
	          
			  if (typeof(event.features[0])=='undefined'){return};
	          LME_NUMBER=event.features[0].attributes.LME_NUMBER;
	          LME_NAME=event.features[0].attributes.LME_NAME;
	          $('#buttonLMEs').attr("href","http://onesharedocean.org/?q=node/"+parseInt(lmeCodeToNode(LME_NUMBER)));
	          $('#buttonLMEs').attr("target","_blank");
			  $('#buttonLMEs').css('display', 'inline-block');
			  $('#tags').prop('value', availableTags[parseInt(LME_NUMBER)-1]);
			  $('#tags').css('color', '#000000');
			  $('#deleteTags').css('display', 'inline-block');
			}
	       }
	    });

	    map.addControl(info);
	    info.activate();

        </script>
	
		<script>
	$(document).ready(function(){
	$("#accordion h3").click(function(){
		//slide up all the link lists
		$("#accordion ul ul").slideUp(400, function(){
				var iFrame = parent.document.getElementById("iFrame");
				if($('#accordion').height() < iFrame.height-25){
					iFrame.height = 600;
				}
			});
		//slide down the link list below the h3 clicked - only if its closed
		if(!$(this).next().is(":visible"))
		{
			$(this).next().slideDown(400, function(){
				var iFrame = parent.document.getElementById("iFrame");
				if($('#accordion').height() > iFrame.height){
					iFrame.height = $('#accordion').height()+25;
				}
			});
		}
	})
});

</script>
<script>
$.get("/iframes/lmes/maps/lmes_portal_legends.html", function(data){
	$('#legOL').html(data);
});

//Post-change of the controls position on the map
$('#OpenLayers_Control_PanZoom_2').css('top','220px');
</script>

</html>
