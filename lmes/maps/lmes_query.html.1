<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <link rel="stylesheet" href="http://193.191.134.61/geoserver/openlayers/theme/default/style.css" type="text/css">
        <style>
            #map-id {
               width: 800px;
               height: 400px;
           }
       </style>

        <script src="http://openlayers.org/api/OpenLayers.js"></script>
    </head>
    <body>

      <a id="infoblock" href="#">Select an LME on the map</a>
      <div id="map-id"></div>

        <script>
	    var extent = new OpenLayers.Bounds(-180,-90,180,90);
	    var minResolution=360/800.0;
	    var maxResolution=0.5/800.0;
	    var options = {restrictedExtent:extent, maxExtent:extent, minResolution:minResolution, maxResolution:maxResolution,
	    controls:[new OpenLayers.Control.PanZoom(), new OpenLayers.Control.NavToolbar()]};

	    nodeCodes={"1":"51", "2":"55", "3":"56", "4":"57", "5":"58", "6":"59", "7":"60", "8":"61", "9":"62", "10":"63",
	    "11":"65", "12":"66", "13":"67", "14":"68", "15":"69", "16":"70", "17":"71", "18":"72", "19":"73", "20":"74",
	    "21":"75", "22":"76", "23":"77", "24":"78", "25":"79", "26":"80", "27":"81", "28":"82", "29":"83", "30":"84", 
	    "31":"85", "32":"86", "33":"87", "34":"88", "35":"89", "36":"90", "37":"91", "38":"92", "39":"93", "40":"94", 
	    "41":"95", "42":"96", "43":"97", "44":"98", "45":"99", "46":"100", "47":"101", "48":"102", "49":"103", "50":"104", 
	    "51":"105", "52":"106", "53":"107", "54":"108", "55":"109", "56":"110", "57":"111", "58":"112", "59":"113", "60":"114", 
	    "61":"115", "62":"116", "63":"117", "64":"118", "65":"119", "66":"120"}; // LME_CODE:"nodeCode"

            var map = new OpenLayers.Map("map-id", options);

/*
            var imagery = new OpenLayers.Layer.WMS(
                "bluemarble",
                "http://maps.opengeo.org/geowebcache/service/wms",
                {layers: "bluemarble", isBaseLayer:false}
            );
*/
	    var gebco = new OpenLayers.Layer.WMS(
	    "GEBCO",
	    "http://193.191.134.61/geoserver/general/wms",
	    {layers:"general:GEBCO_08_Grid",isBaseLayer:false}
	    );

	    var lmes=new OpenLayers.Layer.WMS(
	        "LMEs",
	        "http://193.191.134.61/geoserver/ocean/wms",
	        {layers:"ocean:LME66", transparent:true, styles:'LMES_colors'},
	        { isBaseLayer:false, opacity:1, visibility:true}
	    );

	    map.addLayers([lmes, gebco]);
            map.zoomToMaxExtent();

	    function lmeCodeToNode(code){
	      node=8; // page not found
	      node=nodeCodes[parseInt(code)];
	      return node;
	    }

	    var info = new OpenLayers.Control.WMSGetFeatureInfo({
	       url:'http://193.191.134.61/geoserver/ocean/wms',
	       title:'identify feature by clicking',
	       output:'features',
	       infoFormat:'application/vnd.ogc.gml',
	       format: new OpenLayers.Format.GML,

	       eventListeners: {
	        getfeatureinfo: function(event) {
	          console.log(event);
	          if (typeof(event.features[0])=='undefined'){return};
	          LME_NUMBER=event.features[0].attributes.LME_NUMBER;
	          LME_NAME=event.features[0].attributes.LME_NAME;
	          document.getElementById('infoblock').innerHTML='Visit '+LME_NAME+" (LME #"+parseInt(LME_NUMBER)+")";
	          document.getElementById('infoblock').href="http://193.191.134.61/?q=node/"+parseInt(lmeCodeToNode(LME_NUMBER));
	          document.getElementById('infoblock').target="_blank";
	        }
	       }
	    });


	    map.addControl(info);
	    info.activate();
	    
        </script>
    </body>

</html>
